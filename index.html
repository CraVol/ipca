

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>IPCA Package Documentation &mdash; ipca  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="#" class="icon icon-home"> ipca
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">IPCA Package Documentation</a></li>
<li><a class="reference internal" href="#indices-and-tables">Indices and tables</a></li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">ipca</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="#">Docs</a> &raquo;</li>
        
      <li>IPCA Package Documentation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ipca-package-documentation">
<h1>IPCA Package Documentation<a class="headerlink" href="#ipca-package-documentation" title="Permalink to this headline">¶</a></h1>
<p>This package provides a Python (3.5+) implementation of the Instrumented
Principal Components Analysis framework by Kelly, Pruitt, Su (2017)
[<a class="reference external" href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=2983919">1</a>, <a class="reference external" href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3032013">2</a>].</p>
<div class="toctree-wrapper compound">
</div>
<span class="target" id="module-ipca"></span><dl class="class">
<dt id="ipca.IPCARegressor">
<em class="property">class </em><code class="sig-prename descclassname">ipca.</code><code class="sig-name descname">IPCARegressor</code><span class="sig-paren">(</span><em class="sig-param">n_factors=1</em>, <em class="sig-param">intercept=False</em>, <em class="sig-param">max_iter=10000</em>, <em class="sig-param">iter_tol=1e-05</em>, <em class="sig-param">alpha=0.0</em>, <em class="sig-param">l1_ratio=1.0</em>, <em class="sig-param">n_jobs=1</em>, <em class="sig-param">backend='loky'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ipca/ipca.html#IPCARegressor"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ipca.IPCARegressor" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">sklearn.base.BaseEstimator</span></code></p>
<p>This class implements the IPCA algorithm by Kelly, Pruitt, Su (2017).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>n_factors</strong> (<em>int, default=1</em>) – The total number of factors to estimate. Note, the number of
estimated factors is automatically reduced by the number of
pre-specified factors. For example, if n_factors = 2 and one
pre-specified factor is passed, then IPCARegressor will estimate
one factor estimated in addition to the pre-specified factor.</p></li>
<li><p><strong>intercept</strong> (<em>boolean, default=False</em>) – Determines whether the model is estimated with or without an intercept</p></li>
<li><p><strong>max_iter</strong> (<em>int, default=10000</em>) – Maximum number of alternating least squares updates before the
estimation is stopped</p></li>
<li><p><strong>iter_tol</strong> (<em>float, default=10e-6</em>) – Tolerance threshold for stopping the alternating least squares
procedure</p></li>
<li><p><strong>alpha</strong> (<em>scalar</em>) – Regularizing constant for Gamma estimation.  If this is set to
zero then the estimation defaults to non-regularized.</p></li>
<li><p><strong>l1_ratio</strong> (<em>scalar</em>) – Ratio of l1 and l2 penalties for elastic net Gamma fit.</p></li>
<li><p><strong>n_jobs</strong> (<em>scalar</em>) – number of jobs for F step estimation in ALS, if set to one no
parallelization is done</p></li>
<li><p><strong>backend</strong> (<em>str</em>) – label for Joblib backend used for F step in ALS</p></li>
</ul>
</dd>
</dl>
<dl class="method">
<dt id="ipca.IPCARegressor.BS_Walpha">
<code class="sig-name descname">BS_Walpha</code><span class="sig-paren">(</span><em class="sig-param">ndraws=1000</em>, <em class="sig-param">n_jobs=1</em>, <em class="sig-param">backend='loky'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ipca/ipca.html#IPCARegressor.BS_Walpha"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ipca.IPCARegressor.BS_Walpha" title="Permalink to this definition">¶</a></dt>
<dd><p>Bootstrap inference on the hypothesis Gamma_alpha = 0</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ndraws</strong> (<em>integer, default=1000</em>) – Number of bootstrap draws and re-estimations to be performed</p></li>
<li><p><strong>backend</strong> (<em>optional</em>) – Value is either ‘loky’ or ‘multiprocessing’</p></li>
<li><p><strong>n_jobs</strong> (<em>integer</em>) – Number of workers to be used. If -1, all available workers are
used.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>pval</strong> – P-value from the hypothesis test H0: Gamma_alpha=0</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="ipca.IPCARegressor.BS_Wbeta">
<code class="sig-name descname">BS_Wbeta</code><span class="sig-paren">(</span><em class="sig-param">l</em>, <em class="sig-param">ndraws=1000</em>, <em class="sig-param">n_jobs=1</em>, <em class="sig-param">backend='loky'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ipca/ipca.html#IPCARegressor.BS_Wbeta"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ipca.IPCARegressor.BS_Wbeta" title="Permalink to this definition">¶</a></dt>
<dd><p>Test of instrument significance.
Bootstrap inference on the hypothesis  l-th column of Gamma_beta = 0.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>l</strong> (<em>integer</em>) – Position of the characteristics for which the bootstrap is to be
carried out. For example, if there are 10 characteristics, l is in
the range 0 to 9 (left-/right-inclusive).</p></li>
<li><p><strong>ndraws</strong> (<em>integer, default=1000</em>) – Number of bootstrap draws and re-estimations to be performed</p></li>
<li><p><strong>n_jobs</strong> (<em>integer</em>) – Number of workers to be used for multiprocessing.
If -1, all available Workers are used.</p></li>
<li><p><strong>backend</strong> (<em>optional</em>)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>pval</strong> – P-value from the hypothesis test H0: Gamma_alpha=0</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="ipca.IPCARegressor.fit">
<code class="sig-name descname">fit</code><span class="sig-paren">(</span><em class="sig-param">X=None</em>, <em class="sig-param">y=None</em>, <em class="sig-param">PSF=None</em>, <em class="sig-param">Gamma=None</em>, <em class="sig-param">Factors=None</em>, <em class="sig-param">data_type='portfolio'</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ipca/ipca.html#IPCARegressor.fit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ipca.IPCARegressor.fit" title="Permalink to this definition">¶</a></dt>
<dd><p>Fits the regressor to the data using an alternating least squares
scheme.</p>
<dl class="field-list">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul>
<li><p><strong>X</strong> (<em>numpy array</em>) – X of stacked data. Each row corresponds to an observation
(i, t) where i denotes the entity index and t denotes
the time index. The panel may be unbalanced. The number of unique
entities is n_samples, the number of unique dates is T, and
the number of characteristics used as instruments is L.
The columns of the panel are organized in the following order:</p>
<ul class="simple">
<li><p>Column 1: entity id (i)</p></li>
<li><p>Column 2: time index (t)</p></li>
<li><p>Column 3 to column 3+L: characteristics.</p></li>
</ul>
</li>
<li><p><strong>y</strong> (<em>numpy array</em>) – dependent variable where indices correspond to those in X</p></li>
<li><p><strong>PSF</strong> (<em>numpy array, optional</em>) – Set of pre-specified factors as matrix of dimension (M, T)</p></li>
<li><p><strong>Gamma</strong> (<em>numpy array or None</em>) – If provided, starting values for Gamma (see Notes)</p></li>
<li><p><strong>Factors</strong> (<em>numpy array</em>) – If provided, starting values for Factors (see Notes)</p></li>
<li><p><strong>data_type</strong> (<em>str</em>) – label for data-type used for ALS estimation, one of the following:</p>
<ol class="arabic simple">
<li><p>panel</p></li>
</ol>
<p>ALS uses the untransformed X and y for the estimation.</p>
<p>This is currently marginally slower than the portfolio estimation
but is necessary when performing regularized estimation
(alpha &gt; 0).</p>
<ol class="arabic simple" start="2">
<li><p>portfolio</p></li>
</ol>
<p>ALS uses a matrix of characteristic weighted portfolios (Q)
as well as a matrix of weights (W) and count of non-missing
observations for each time period (val_obs) for the estimation.</p>
<p>See _unpack_panel for details on how these variables are formed
from the initial X and y.</p>
<p>Currently, the bootstrap procedure is only implemented in terms
of the portfolio data_type.</p>
</li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>self</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Updates IPCARegressor instances to include param estimates:</p>
<dl class="simple">
<dt>Gamma<span class="classifier">numpy array</span></dt><dd><p>Array with dimensions (L, n_factors) containing the
mapping between characteristics and factors loadings. If there
are M many pre-specified factors in the model then the
matrix returned is of dimension (L, (n_factors+M)).
If an intercept is included in the model, its loadings are
returned in the last column of Gamma.</p>
</dd>
<dt>Factors<span class="classifier">numpy array</span></dt><dd><p>Array with dimensions (n_factors, T) containing the estimated
factors. If pre-specified factors were passed the returned
array is of dimension ((n_factors - M), T),
corresponding to the n_factors - M many factors estimated on
top of the pre-specified ones.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="ipca.IPCARegressor.fit_path">
<code class="sig-name descname">fit_path</code><span class="sig-paren">(</span><em class="sig-param">X=None</em>, <em class="sig-param">y=None</em>, <em class="sig-param">PSF=None</em>, <em class="sig-param">alpha_l=None</em>, <em class="sig-param">n_splits=10</em>, <em class="sig-param">split_method=&lt;class 'sklearn.model_selection._split.GroupKFold'&gt;</em>, <em class="sig-param">n_jobs=1</em>, <em class="sig-param">backend='loky'</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ipca/ipca.html#IPCARegressor.fit_path"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ipca.IPCARegressor.fit_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Fit a path of elastic net fits for various regularizing constants</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X</strong> (<em>numpy array</em>) – X of stacked data. Each row corresponds to an observation
(i, t) where i denotes the entity index and t denotes
the time index. The panel may be unbalanced. The number of unique
entities is n_samples, the number of unique dates is T, and
the number of characteristics used as instruments is L.
The columns of the panel are organized in the following order:</p>
<ul>
<li><p>Column 1: entity id (i)</p></li>
<li><p>Column 2: time index (t)</p></li>
<li><p>Column 3 to column 3+L: characteristics.</p></li>
</ul>
</li>
<li><p><strong>y</strong> (<em>numpy array</em>) – dependent variable where indices correspond to those in X</p></li>
<li><p><strong>PSF</strong> (<em>numpy array, optional</em>) – Set of pre-specified factors as matrix of dimension (M, T)</p></li>
<li><p><strong>alpha_l</strong> (<em>iterable or None</em>) – list of regularizing constants to use for path</p></li>
<li><p><strong>n_splits</strong> (<em>scalar</em>) – number of CV partitions</p></li>
<li><p><strong>split_method</strong> (<em>sklearn cross-validation generator factory</em>) – method to generate CV partitions</p></li>
<li><p><strong>n_jobs</strong> (<em>scalar</em>) – number of jobs for parallel CV estimation</p></li>
<li><p><strong>backend</strong> (<em>str</em>) – label for joblib backend</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>cvmse</strong> – array of dim (P x (C + 1)) where P is the number of reg
constants and C is the number of CV partitions</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy matrix</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="ipca.IPCARegressor.predict">
<code class="sig-name descname">predict</code><span class="sig-paren">(</span><em class="sig-param">X=None</em>, <em class="sig-param">y=None</em>, <em class="sig-param">mean_factor=False</em>, <em class="sig-param">data_type='panel'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ipca/ipca.html#IPCARegressor.predict"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ipca.IPCARegressor.predict" title="Permalink to this definition">¶</a></dt>
<dd><p>wrapper around different data type predict methods</p>
</dd></dl>

<dl class="method">
<dt id="ipca.IPCARegressor.predictOOS">
<code class="sig-name descname">predictOOS</code><span class="sig-paren">(</span><em class="sig-param">X=None</em>, <em class="sig-param">y=None</em>, <em class="sig-param">mean_factor=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ipca/ipca.html#IPCARegressor.predictOOS"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ipca.IPCARegressor.predictOOS" title="Permalink to this definition">¶</a></dt>
<dd><p>Predicts time t+1 observation using an out-of-sample design.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X</strong> (<em>numpy array</em>) – X of stacked data. Each row corresponds to an observation
(i,t) where i denotes the entity index and t denotes
the time index. All data must correspond to time t, i.e. all
observations occur on the same date.
If an observation contains missing data NaN will be returned.
Note that the number of characteristics (L) passed,
has to match the number of characteristics used when fitting
the regressor.
The columns of the panel are organized in the following order:</p>
<ul>
<li><p>Column 1: entity id (i)</p></li>
<li><p>Column 2: time index (t)</p></li>
<li><p>Column 3 to column 3+L: characteristics.</p></li>
</ul>
</li>
<li><p><strong>y</strong> (<em>numpy array</em>) – dependent variable where indices correspond to those in X</p></li>
<li><p><strong>mean_factor</strong> (<em>boolean</em>) – If true, the estimated factors are averaged in the time-series
before prediction.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>ypred</strong> – The length of the returned array matches the
the length of data. A nan will be returned if there is missing
characteristics information.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy array</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="ipca.IPCARegressor.predict_panel">
<code class="sig-name descname">predict_panel</code><span class="sig-paren">(</span><em class="sig-param">X=None</em>, <em class="sig-param">mean_factor=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ipca/ipca.html#IPCARegressor.predict_panel"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ipca.IPCARegressor.predict_panel" title="Permalink to this definition">¶</a></dt>
<dd><p>Predicts fitted values for a previously fitted regressor + panel data</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X</strong> (<em>numpy array</em>) – X of stacked data. Each row corresponds to an observation
(i, t) where i denotes the entity index and t denotes
the time index. The panel may be unbalanced. If an observation
contains missing data NaN will be returned. Note that the
number of passed characteristics L must match the
number of characteristics used when fitting the regressor.
The columns of the panel are organized in the following order:</p>
<ul>
<li><p>Column 1: entity id (i)</p></li>
<li><p>Column 2: time index (t)</p></li>
<li><p>Column 3 to column 3+L: characteristics.</p></li>
</ul>
</li>
<li><p><strong>mean_factor</strong> (<em>boolean</em>) – If true, the estimated factors are averaged in the time-series
before prediction.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>ypred</strong> – The length of the returned array matches the
the length of data. A nan will be returned if there is missing
characteristics information.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy array</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="ipca.IPCARegressor.predict_portfolio">
<code class="sig-name descname">predict_portfolio</code><span class="sig-paren">(</span><em class="sig-param">X=None</em>, <em class="sig-param">y=None</em>, <em class="sig-param">mean_factor=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ipca/ipca.html#IPCARegressor.predict_portfolio"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ipca.IPCARegressor.predict_portfolio" title="Permalink to this definition">¶</a></dt>
<dd><p>Predicts fitted values for a previously fitted regressor + portfolios</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X</strong> (<em>numpy array</em>) – X of stacked data. Each row corresponds to an observation
(i, t) where i denotes the entity index and t denotes
the time index. The panel may be unbalanced. If an observation
contains missing data NaN will be returned. Note that the
number of passed characteristics L must match the
number of characteristics used when fitting the regressor.
The columns of the panel are organized in the following order:</p>
<ul>
<li><p>Column 1: entity id (i)</p></li>
<li><p>Column 2: time index (t)</p></li>
<li><p>Column 3 to column 3+L: characteristics.</p></li>
</ul>
</li>
<li><p><strong>y</strong> (<em>numpy array</em>) – dependent variable where indices correspond to those in X.
Needed to unwrap panel.</p></li>
<li><p><strong>mean_factor</strong> (<em>boolean</em>) – If true, the estimated factors are averaged in the time-series
before prediction.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>Ypred</strong> – Same dimensions as a char formed portfolios (Q)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy array</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="ipca.IPCARegressor.score">
<code class="sig-name descname">score</code><span class="sig-paren">(</span><em class="sig-param">X=None</em>, <em class="sig-param">y=None</em>, <em class="sig-param">mean_factor=False</em>, <em class="sig-param">data_type='panel'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ipca/ipca.html#IPCARegressor.score"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ipca.IPCARegressor.score" title="Permalink to this definition">¶</a></dt>
<dd><p>generate the panel R^2</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="indices-and-tables">
<h1>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p></li>
</ul>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Matthias Buechner

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>